const staticDir="../static/",getSpritePath=function(t){return staticDir+"sprites/"+t+".png"},getSfxPath=function(t){return staticDir+"sfx/"+t+".wav"},getScriptPath=function(t){return staticDir+"js/"+t+".js"},colour={bg:"#091f34",fg:"#fdfdfd",white:"#fdfdfd",pink:"#fc8cc0",red:"#fd2970",orange:"#fd8e25",yellow:"#f2e31d",green:"#7efebe",lightBlue:"#6ee5fd",darkBlue:"#2c6795"},fontName="vcrosdmono",textStyle={bg:function(t){return{font:fontName,fill:colour.bg,fontSize:t}},fg:function(t){return{font:fontName,fill:colour.fg,fontSize:t}}},world={length:20,tileSize:16,xMargin:10,yMargin:50},util={randomFloat:function(t,e){var i=Math.random();return null==t&&null==e?i:(null==e&&(e=t,t=0),i*=e-t,i+=t)},randomInt:function(t,e){e=util.randomFloat(t,e);return e=Math.floor(e)},randomBool:function(){return util.randomInt(0,2)},recentreText:function(t,e,i){var o=t.width/2;t.x=e?e-o:t.x-o,t.y=i||t.y},rightAlignText:function(t,e){t.x=null==e?t.x-t.width:e-t.width},createTileBg:function(t,e,i,o,r){t.classType=Phaser.Image;for(var a=0;a<e;++a){var s=a*o;tile=t.create(s,r,i)}},deviceInPortraitMode:function(t){return!t.device.desktop&&"portrait-primary"==t.scale.screenOrientation},calculateTileScale:function(t,e){return Math.trunc(t/e.length)/e.tileSize},checkCanvasSize:function(t){}},flasher={make:function(t,e,i){t.flashCountMax=e?2*e:8,t.flashCount=t.flashCountMax,t.tickRate=i||100,t.lastTicked=Date.now()},start:function(t){t.visible=!0,t.flashCount=0},stop:function(t){t.visible=!0,t.flashCount=t.flashCountMax},update:function(t){t.flashCount>=t.flashCountMax||Date.now()-t.lastTicked>=t.tickRate&&(t.lastTicked=Date.now(),t.visible=!t.visible,++t.flashCount)}},textFlasher={make:function(t,e,i,o){i=i||"#fd2970",flasher.make(t,e,o),t.originalStyle=t.style,t.flashStyle={font:t.style.font,fill:i,fontSize:t.style.fontSize}},updateStyleSizes:function(t){t.originalStyle.fontSize=t.style.fontSize,t.flashStyle.fontSize=t.style.fontSize},start:function(t){t.setStyle(t.originalStyle),t.flashCount=0},stop:function(t){t.setStyle(t.originalStyle),t.flashCount=t.flashCountMax},update:function(t){var e;t.flashCount>=t.flashCountMax||Date.now()-t.lastTicked>=t.tickRate&&(e=t.flashCount%2==0?t.flashStyle:t.originalStyle,t.setStyle(e),t.lastTicked=Date.now(),++t.flashCount)}};var keycodes={left:["a","ArrowLeft"],right:["d","ArrowRight"],restart:["r"],up:["w","ArrowUp"],down:["s","ArrowDown"],space:[" "]},game=new Phaser.Game("100%","100%",Phaser.AUTO,"",null,!1,!1);world.length=40,world.tileSize=8;var MainState=function(){};MainState.prototype={paddlePosition:0,ballPosition:19,ballVelocity:-.5,blockAmount:4,sceneGroup:void 0,paddleSprite:void 0,ballSprite:void 0,blockSprites:void 0,uiGroup:void 0,debugText:void 0,scoreText:void 0,scoreNumberText:void 0,gameOverText:void 0,highScoreText:void 0,endScoreText:void 0,restartButton:void 0,score:0,gameOver:!1,bloppSfx:void 0,pickupSfx:void 0,youWinSfx:void 0,preload:function(){game.load.image("paddle",getSpritePath("paddle")),game.load.image("ball",getSpritePath("ball")),game.load.image("block0",getSpritePath("block0")),game.load.image("block1",getSpritePath("block1")),game.load.image("block2",getSpritePath("block2")),game.load.image("block3",getSpritePath("block3")),game.load.image("bgtile",getSpritePath("bgtilehalf")),game.load.spritesheet("button",getSpritePath("button-200x60"),200,60,2),game.load.audio("blopp",getSfxPath("move")),game.load.audio("pickup",getSfxPath("pickup")),game.load.audio("youwin",getSfxPath("youwin")),game.add.text(0,0,"",textStyle.fg(56))},restart:function(){this.score=0,this.gameOver=!1,this.paddlePosition=0,this.ballPosition=19,this.ballVelocity=-.5,this.blockAmount=4,this.createSceneSprites(),this.createUiSprites(),this.rescale()},createSceneSprites:function(){this.sceneGroup&&this.sceneGroup.destroy(),this.sceneGroup=game.add.group(),this.bgTiles&&this.bgTiles.destroy(),this.bgTiles=game.add.group(),this.blockSprites=game.add.group(),this.blockSprites.classType=Phaser.Image,util.createTileBg(this.bgTiles,world.length,"bgtile",world.tileSize,0);for(var t=0;t<this.blockAmount;++t){var e=world.length-1-t;this.blockSprites.create(e*world.tileSize,0,"block"+t).tilePosition=e}this.paddleSprite=game.add.sprite(this.paddlePosition*world.tileSize,0,"paddle"),this.ballSprite=game.add.sprite(this.ballPosition*world.tileSize,0,"ball"),this.sceneGroup.addChild(this.bgTiles),this.sceneGroup.addChild(this.blockSprites),this.sceneGroup.addChild(this.paddleSprite),this.sceneGroup.addChild(this.ballSprite),this.scaleSceneGroup()},buttonTextOver:function(){this.children.forEach(function(t){t.setStyle(textStyle.bg(t.style.fontSize))})},buttonTextOut:function(){this.children.forEach(function(t){t.setStyle(textStyle.fg(t.style.fontSize))})},createUiSprites:function(){this.uiGroup&&this.uiGroup.destroy(),this.uiGroup=game.add.group(),this.scoreText=game.add.text(world.xMargin,world.yMargin,"Score: ",textStyle.fg(56)),this.scoreNumberText=game.add.text(world.xMargin+this.scoreText.width,world.yMargin,"0",textStyle.fg(56)),this.gameOverText=game.add.text(0,0,"YOU WIN!",textStyle.fg(56)),this.highScoreText=game.add.text(0,0,"High score: ",textStyle.fg(32)),this.endScoreText=game.add.text(0,0,"Your score: ",textStyle.fg(32)),this.restartButton=game.add.button(0,0,"button",this.restart,this,1,0,1),this.restartButton.addChild(game.add.text(12,15,"PLAY AGAIN",textStyle.fg(30))),this.restartButton.onInputOver.add(this.buttonTextOver,this.restartButton),this.restartButton.onInputOut.add(this.buttonTextOut,this.restartButton),textFlasher.make(this.scoreNumberText,2),this.gameOverText.visible=!1,this.highScoreText.visible=!1,this.endScoreText.visible=!1,this.restartButton.visible=!1,this.uiGroup.addChild(this.scoreText),this.uiGroup.addChild(this.scoreNumberText),this.uiGroup.addChild(this.gameOverText),this.uiGroup.addChild(this.highScoreText),this.uiGroup.addChild(this.endScoreText),this.uiGroup.addChild(this.restartButton),this.scaleUiGroup()},scaleSceneGroup:function(){var t,e,i;util.deviceInPortraitMode(game)?(i=game.world.height-2*world.xMargin,e=Math.trunc(i/world.length)/world.tileSize,this.sceneGroup.x=game.world.width/2,this.sceneGroup.y=game.world.height-world.xMargin,this.sceneGroup.scale.set(e,e),this.sceneGroup.angle=-90):(t=game.world.width-2*world.xMargin,i=Math.trunc(t/world.length),e=i/world.tileSize,i=(t-i*world.length)/2+world.xMargin,this.sceneGroup.x=i,this.sceneGroup.y=game.world.height/2,this.sceneGroup.scale.set(e,e),this.sceneGroup.angle=0)},scaleUiGroup:function(){let t=56,e=40,i=60;util.deviceInPortraitMode(game)?(t=70,e=44,i=70):game.world.width<800&&!util.deviceInPortraitMode(game)?(t=24,e=16,i=28):game.world.width<1200&&(t=40,e=28,i=44),this.scoreText.setStyle(textStyle.fg(t)),this.scoreNumberText.setStyle(textStyle.fg(t)),this.gameOverText.setStyle(textStyle.fg(t)),this.highScoreText.setStyle(textStyle.fg(e)),this.endScoreText.setStyle(textStyle.fg(e)),textFlasher.updateStyleSizes(this.scoreNumberText);var o=world.yMargin,r=game.world.width/2;util.deviceInPortraitMode(game)?(this.uiGroup.angle=-90,this.uiGroup.y=game.world.height-world.xMargin,r=game.world.height/2,o=2*world.yMargin,this.restartButton.scale.set(2,2)):(this.uiGroup.angle=0,this.uiGroup.y=0,this.restartButton.scale.set(1,1)),util.recentreText(this.gameOverText,r,o),util.recentreText(this.highScoreText,r,o+i),util.recentreText(this.endScoreText,r,o+2*i),util.recentreText(this.restartButton,r,o+3*i),this.scoreText.y=o,this.scoreNumberText.x=this.scoreText.width,this.scoreNumberText.y=this.scoreText.y},rescale:function(){this.scaleSceneGroup(),this.scaleUiGroup()},create:function(){game.scale.scaleMode=Phaser.ScaleManager.RESIZE,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.onSizeChange.add(this.rescale,this),this.debugText=game.add.text(0,0,"dbg",textStyle.fg(18)),this.debugText.visible=!1,game.stage.backgroundColor=colour.bg,game.stage.smoothed=!1,this.createSceneSprites(),this.createUiSprites(),this.bloppSfx=game.add.audio("blopp",.5),this.pickupSfx=game.add.audio("pickup",.3),this.youWinSfx=game.add.audio("youwin",.2),game.input.keyboard.callbackContext=this,game.input.keyboard.onDownCallback=function(t){keycodes.restart.includes(t.key)&&this.restart()}},update:function(){this.gameOver||(this.ballPosition+=this.ballVelocity,this.ballSprite.position.x=this.ballPosition*world.tileSize,0==this.blockSprites.children.length?this.win():this.ballPosition<=this.paddlePosition+1?(this.ballVelocity*=-1,this.bloppSfx.play()):this.ballPosition>=this.getLastBlock().tilePosition-1&&(this.ballVelocity*=-1,this.score++,this.scoreNumberText.text=this.score,textFlasher.start(this.scoreNumberText),1!=this.blockSprites.children.length&&this.pickupSfx.play(),this.getLastBlock().destroy()),textFlasher.update(this.scoreNumberText))},win:function(){this.gameOver=!0,this.scoreText.visible=!1,this.scoreNumberText.visible=!1,this.gameOverText.visible=!0,this.highScoreText.visible=!0,this.endScoreText.visible=!0,this.restartButton.visible=!0,this.highScoreText.text="High score: "+this.score,this.endScoreText.text="Your score: "+this.score,util.deviceInPortraitMode(game)?(util.recentreText(this.highScoreText,game.world.height/2),util.recentreText(this.endScoreText,game.world.height/2)):(util.recentreText(this.highScoreText,game.world.width/2),util.recentreText(this.endScoreText,game.world.width/2)),this.youWinSfx.play()},getLastBlock:function(){var t=this.blockSprites.children.length-1;return this.blockSprites.children[t]}},game.state.add("MainState",MainState),game.state.start("MainState");