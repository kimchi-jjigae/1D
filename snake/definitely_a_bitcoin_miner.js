const staticDir="../static/",getSpritePath=function(e){return staticDir+"sprites/"+e+".png"},getSfxPath=function(e){return staticDir+"sfx/"+e+".wav"},getScriptPath=function(e){return staticDir+"js/"+e+".js"},colour={bg:"#091f34",fg:"#fdfdfd",white:"#fdfdfd",pink:"#fc8cc0",red:"#fd2970",orange:"#fd8e25",yellow:"#f2e31d",green:"#7efebe",lightBlue:"#6ee5fd",darkBlue:"#2c6795"},fontName="vcrosdmono",textStyle={bg:function(e){return{font:fontName,fill:colour.bg,fontSize:e}},fg:function(e){return{font:fontName,fill:colour.fg,fontSize:e}}},world={length:20,tileSize:16,xMargin:10,yMargin:50},util={randomFloat:function(e,t){var i=Math.random();return null==e&&null==t?i:(null==t&&(t=e,e=0),i*=t-e,i+=e)},randomInt:function(e,t){t=util.randomFloat(e,t);return t=Math.floor(t)},randomBool:function(){return util.randomInt(0,2)},recentreText:function(e,t,i){var a=e.width/2;e.x=t?t-a:e.x-a,e.y=i||e.y},rightAlignText:function(e,t){e.x=null==t?e.x-e.width:t-e.width},createTileBg:function(e,t,i,a,s){for(var o=0;o<t;++o){var r=o*a;tile=e.create(r,s,i)}},deviceInPortraitMode:function(e){return!e.device.desktop&&"portrait-primary"==e.scale.screenOrientation},calculateTileScale:function(e,t){return Math.trunc(e/t.length)/t.tileSize},checkCanvasSize:function(e){}},flasher={make:function(e,t,i){e.flashCountMax=t?2*t:8,e.flashCount=e.flashCountMax,e.tickRate=i||100,e.lastTicked=Date.now()},start:function(e){e.visible=!0,e.flashCount=0},stop:function(e){e.visible=!0,e.flashCount=e.flashCountMax},update:function(e){e.flashCount>=e.flashCountMax||Date.now()-e.lastTicked>=e.tickRate&&(e.lastTicked=Date.now(),e.visible=!e.visible,++e.flashCount)}},textFlasher={make:function(e,t,i,a){i=i||"#fd2970",flasher.make(e,t,a),e.originalStyle=e.style,e.flashStyle={font:e.style.font,fill:i,fontSize:e.style.fontSize}},updateStyleSizes:function(e){e.originalStyle.fontSize=e.style.fontSize,e.flashStyle.fontSize=e.style.fontSize},start:function(e){e.setStyle(e.originalStyle),e.flashCount=0},stop:function(e){e.setStyle(e.originalStyle),e.flashCount=e.flashCountMax},update:function(e){var t;e.flashCount>=e.flashCountMax||Date.now()-e.lastTicked>=e.tickRate&&(t=e.flashCount%2==0?e.flashStyle:e.originalStyle,e.setStyle(t),e.lastTicked=Date.now(),++e.flashCount)}};var DIRECTION=Object.freeze({LEFT:1,RIGHT:2,UP:3,DOWN:4}),keycodes={left:["a","ArrowLeft"],right:["d","ArrowRight"],restart:["r"],up:["w","ArrowUp"],down:["s","ArrowDown"],space:[" "]},game=new Phaser.Game("100%","100%",Phaser.AUTO,"",null,!1,!1),Snake=function(){};Snake.prototype={length:4,position:4,grow:function(){this.length++},reset:function(){this.length=4,this.position=4}};var Apple=function(){};Apple.prototype={position:8,respawn:function(e,t,i){for(var a,s,o,r=e%i,n=(e-t)%i+1,l=util.randomInt(20);a=l,(o=n)<(s=r)?o<=a&&a<=s:a<=s||o<=a;)l=util.randomInt(20);this.position=l},reset:function(){this.position=8}};var snake=new Snake,apple=new Apple,MainState=function(){};MainState.prototype={tickRate:300,lastTicked:Date.now(),sceneGroup:void 0,snakeBits:void 0,appleBit:void 0,uiGroup:void 0,debugText:void 0,scoreText:void 0,gameOverText:void 0,highScoreText:void 0,restartButton:void 0,score:0,gameOver:!1,bloppSfx:void 0,pickupSfx:void 0,gameoverSfx:void 0,preload:function(){game.load.image("head",getSpritePath("snakehead")),game.load.image("headdead",getSpritePath("snakeheaddead")),game.load.image("snake",getSpritePath("snakebody")),game.load.image("apple",getSpritePath("apple")),game.load.image("bgtile",getSpritePath("bgtile")),game.load.spritesheet("button",getSpritePath("button-200x60"),200,60,2),game.load.audio("blopp",getSfxPath("move")),game.load.audio("pickup",getSfxPath("pickup")),game.load.audio("gameover",getSfxPath("gameover")),game.add.text(0,0,"",textStyle.fg(56))},restart:function(){this.score=0,this.gameOver=!1,snake.reset(),apple.reset(),this.createSceneSprites(),this.createUiSprites(),this.rescale()},createSceneSprites:function(){this.sceneGroup&&this.sceneGroup.destroy(),this.sceneGroup=game.add.group(),this.bgTiles=game.add.group(),this.snakeBits=game.add.group(),this.snakeBits.classType=Phaser.Image,util.createTileBg(this.bgTiles,world.length,"bgtile",world.tileSize,0);this.snakeBits.create(snake.position*world.tileSize,0,"head");for(var e=1;e<snake.length;++e)this.snakeBits.create((snake.position-e)*world.tileSize,0,"snake");flasher.make(this.snakeBits),this.appleBit=game.add.image(apple.position*world.tileSize,0,"apple"),this.sceneGroup.addChild(this.bgTiles),this.sceneGroup.addChild(this.snakeBits),this.sceneGroup.addChild(this.appleBit),this.scaleSceneGroup()},buttonTextOver:function(){this.children.forEach(function(e){e.setStyle(textStyle.bg(e.style.fontSize))})},buttonTextOut:function(){this.children.forEach(function(e){e.setStyle(textStyle.fg(e.style.fontSize))})},createUiSprites:function(){this.uiGroup&&this.uiGroup.destroy(),this.uiGroup=game.add.group(),this.scoreText=game.add.text(world.xMargin,world.yMargin,"Score: ",textStyle.fg(56)),this.scoreNumberText=game.add.text(world.xMargin+this.scoreText.width,world.yMargin,"0",textStyle.fg(56)),this.gameOverText=game.add.text(0,0,"GAME OVER!",textStyle.fg(56)),this.highScoreText=game.add.text(0,0,"High score: ",textStyle.fg(32)),this.endScoreText=game.add.text(0,0,"Your score: ",textStyle.fg(32)),this.restartButton=game.add.button(0,0,"button",this.restart,this,1,0,1),this.restartButton.addChild(game.add.text(12,15,"PLAY AGAIN",textStyle.fg(30))),this.restartButton.onInputOver.add(this.buttonTextOver,this.restartButton),this.restartButton.onInputOut.add(this.buttonTextOut,this.restartButton),textFlasher.make(this.scoreNumberText,2),this.gameOverText.visible=!1,this.highScoreText.visible=!1,this.endScoreText.visible=!1,this.restartButton.visible=!1,this.uiGroup.addChild(this.scoreText),this.uiGroup.addChild(this.scoreNumberText),this.uiGroup.addChild(this.gameOverText),this.uiGroup.addChild(this.highScoreText),this.uiGroup.addChild(this.endScoreText),this.uiGroup.addChild(this.restartButton),this.scaleUiGroup()},scaleSceneGroup:function(){var e,t,i;util.deviceInPortraitMode(game)?(i=game.world.height-2*world.xMargin,t=Math.trunc(i/world.length)/world.tileSize,this.sceneGroup.x=game.world.width/2,this.sceneGroup.y=game.world.height-world.xMargin,this.sceneGroup.scale.set(t,t),this.sceneGroup.angle=-90):(e=game.world.width-2*world.xMargin,i=Math.trunc(e/world.length),t=i/world.tileSize,i=(e-i*world.length)/2+world.xMargin,this.sceneGroup.x=i,this.sceneGroup.y=game.world.height/2,this.sceneGroup.scale.set(t,t),this.sceneGroup.angle=0)},scaleUiGroup:function(){let e=56,t=40,i=60;util.deviceInPortraitMode(game)?(e=70,t=44,i=70,console.log("blarpp")):game.world.width<800&&!util.deviceInPortraitMode(game)?(e=24,t=16,i=28):game.world.width<1200&&(e=40,t=28,i=44),this.scoreText.setStyle(textStyle.fg(e)),this.scoreNumberText.setStyle(textStyle.fg(e)),this.gameOverText.setStyle(textStyle.fg(e)),this.highScoreText.setStyle(textStyle.fg(t)),this.endScoreText.setStyle(textStyle.fg(t)),textFlasher.updateStyleSizes(this.scoreNumberText);var a=world.yMargin,s=game.world.width/2;util.deviceInPortraitMode(game)?(this.uiGroup.angle=-90,this.uiGroup.y=game.world.height-world.xMargin,s=game.world.height/2,a=2*world.yMargin,this.restartButton.scale.set(2,2)):(this.uiGroup.angle=0,this.uiGroup.y=0,this.restartButton.scale.set(1,1)),util.recentreText(this.gameOverText,s,a),util.recentreText(this.highScoreText,s,a+i),util.recentreText(this.endScoreText,s,a+2*i),util.recentreText(this.restartButton,s,a+3*i),this.scoreText.y=a,this.scoreNumberText.x=this.scoreText.width,this.scoreNumberText.y=this.scoreText.y},rescale:function(){this.scaleSceneGroup(),this.scaleUiGroup()},create:function(){game.scale.scaleMode=Phaser.ScaleManager.RESIZE,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.onSizeChange.add(this.rescale,this),this.debugText=game.add.text(0,0,"dbg",textStyle.fg(18)),this.debugText.visible=!1,game.stage.backgroundColor=colour.bg,game.stage.smoothed=!1,this.createSceneSprites(),this.createUiSprites(),this.bloppSfx=game.add.audio("blopp",.5),this.pickupSfx=game.add.audio("pickup",.3),this.gameoverSfx=game.add.audio("gameover"),game.input.onTap.add(function(){this.lastTicked=0},this),game.input.keyboard.callbackContext=this,game.input.keyboard.onDownCallback=function(e){keycodes.right.includes(e.key)?this.lastTicked=0:keycodes.restart.includes(e.key)&&this.restart()}},update:function(){if(this.timeToTick()&&!this.gameOver){snake.position++,this.bloppSfx.play();for(var e=0;e<this.snakeBits.length;++e){var t=this.snakeBits.children[e],i=(snake.position-e)%world.length;t.position.x=i*world.tileSize}!this.gameOver&&this.eatTail()?this.lose():this.eatApple()&&(this.score++,this.scoreNumberText.text=this.score,textFlasher.start(this.scoreNumberText),snake.grow(),i=(snake.position-snake.length+1)%world.length,t=this.snakeBits.create(i*world.tileSize,world.yOffset,"snake"),this.pickupSfx.play(),snake.length<world.length?(apple.respawn(snake.position,snake.length,world.length),this.appleBit.position.x=apple.position*world.tileSize):this.appleBit.destroy())}else this.gameOver&&flasher.update(this.snakeBits);textFlasher.update(this.scoreNumberText)},lose:function(){this.gameOver=!0,this.scoreText.visible=!1,this.scoreNumberText.visible=!1,this.gameOverText.visible=!0,this.highScoreText.visible=!0,this.endScoreText.visible=!0,this.restartButton.visible=!0,this.highScoreText.text="High score: "+this.score,this.endScoreText.text="Your score: "+this.score,util.deviceInPortraitMode(game)?(util.recentreText(this.highScoreText,game.world.height/2),util.recentreText(this.endScoreText,game.world.height/2)):(util.recentreText(this.highScoreText,game.world.width/2),util.recentreText(this.endScoreText,game.world.width/2)),this.snakeBits.children[0].loadTexture("headdead"),flasher.start(this.snakeBits),this.gameoverSfx.play()},timeToTick:function(){var e=!1;return Date.now()-this.lastTicked>=this.tickRate&&(this.lastTicked=Date.now(),e=!0),e},eatApple:function(){return snake.position%world.length==apple.position},eatTail:function(){return snake.position%world.length==(snake.position-snake.length)%world.length}},game.state.add("MainState",MainState),game.state.start("MainState");